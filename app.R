#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# Find out more about building applications with Shiny here:
#
#    http://shiny.rstudio.com/
#

library(shiny)
library(tidyverse)

# Define UI for application that draws a histogram
ui <- fluidPage(
   
   # Application title
   titlePanel("Experimento: Microalgas en injertos de vid"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
        selectInput(inputId = "y",
                    label = "Seleccione eje Y:",
                    choices = c("Número de hojas" = "hojas", 
                                "Longitud del brote" = "altura", 
                                "Circunferencia del brote" = "circ", 
                                "Crecimiento de hojas" = "cre_h", 
                                "Desarrollo del brote" = "cre_a", 
                                "Desarrollo de circunferencia" = "cre_circ"),
                    selected = "cre_h"
        ),
        selectInput(inputId = "x",
                    label = "Seleccione eje X:",
                    choices = c("Día Juliano" = "fecha",
                                "Forma de aplicación" = "modo_app", 
                                "Dosis en g/L" = "dosis"),
                    selected = "modo_app"
        ),
        selectInput(inputId = "color",
                    label = "Clasificado por:",
                    choices = c("Día Juliano" = "fecha", 
                                "Forma de aplicación" = "modo_app", 
                                "Dosis en g/L" = "dosis"),
                    selected = "dosis"
        )
        
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput("distPlot"),
         tags$br(),
         tags$h5("Simbología: 'AS', se refiere a aplicación foliar, 'RI', se refiere a ",
                 "aplicación en la base del portainjerto, 'b', se refiere a testigo."),
         br(),
         tags$h5("Todas las longitudes se refieren a centímetros."),
         br(),
         tags$h5("A todas las plantas se les realizarón aplicaciones de 1ml cada dos semanas. ",
                 "con exepción de los testigos"),
         br(),
         h5("El experimento se realizó en 35 injertos, para la evaluación de ",
            "la aplicación por riego y aspersión de tres concentraciones de algas. ",
            "Todas las mediciones se hicieron por quintuplicado."),
         br(),
         h3("Conclusiones:"),
         br(),
         h5("Los resultados arriba mostrados sugieren que la aplicación de microalgas ",
            "de forma foliar fomenta el desarrollo de hojas, mientras que las aplicaciones ",
            "dirigidas a la bse del prtainjerto, fomentan la enlongación de las guías."),
         br(),
         h5("Se observa un mayor desarrollo con la concentración de 0.5 ", 
            "gramos por litro, se recomienda ",
            "corroborar nuevamente este efecto a esta concentración, y ademas con ",
            "concentraciones menores."),
         br(),
         h5("Se recomienda repetir el exprimento para corroborar los resultados ",
            "de este estudio, debido al sesgo que pudiera existir a la hora de seleccionar ",
            "los grupos de estudio, existe la sospecha de que desde un inicio se ",
            "eligieron especimenes con poco desarrollo para formar el grupo de control ",
            "pero al comparar el crecimiento diferencial de las tres variables ",
            "de respuesta se observa que aun asi, el efecto fue mayor en los grupos que ",
            "recibieron tratamiento con microalgas."),
         br()
      )
   )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
   
   output$distPlot <- renderPlot({
    aep2305 <- filter(tribble(
      ~n,~fecha,~modo_app,~dosis,~hojas,~altura,~circ,~cre_h,~cre_a,~cre_circ,
      "1","112","RI","0.5",14,38,4.3,NA,NA,NA,
      "2","112","RI","0.5",15,34,4.6,NA,NA,NA,
      "3","112","RI","0.5",17,31,3.6,NA,NA,NA,
      "4","112","RI","0.5",12,38,3.9,NA,NA,NA,
      "5","112","RI","0.5",24,41,3.6,NA,NA,NA,
      "6","112","AS","0.5",28,37,3.4,NA,NA,NA,
      "7","112","AS","0.5",14,21,4.1,NA,NA,NA,
      "8","112","AS","0.5",17,31,3.7,NA,NA,NA,
      "9","112","AS","0.5",14,22,3.4,NA,NA,NA,
      "10","112","AS","0.5",28,38,3.2,NA,NA,NA,
      "11","112","RI","1",25,39,3.1,NA,NA,NA,
      "12","112","RI","1",15,33,3.2,NA,NA,NA,
      "13","112","RI","1",15,18,3,NA,NA,NA,
      "14","112","RI","1",18,42,3.3,NA,NA,NA,
      "15","112","RI","1",16,32,3,NA,NA,NA,
      "16","112","AS","1",18,23,3,NA,NA,NA,
      "17","112","AS","1",25,43,3.4,NA,NA,NA,
      "18","112","AS","1",15,35,3.3,NA,NA,NA,
      "19","112","AS","1",21,30,3.1,NA,NA,NA,
      "20","112","AS","1",23,39,3.1,NA,NA,NA,
      "21","112","RI","1.5",13,30,3.8,NA,NA,NA,
      "22","112","RI","1.5",12,34,3.5,NA,NA,NA,
      "23","112","RI","1.5",16,32,4.2,NA,NA,NA,
      "24","112","RI","1.5",12,31,3.8,NA,NA,NA,
      "25","112","RI","1.5",19,33,3.1,NA,NA,NA,
      "26","112","AS","1.5",14,30,3.2,NA,NA,NA,
      "27","112","AS","1.5",19,25,3.2,NA,NA,NA,
      "28","112","AS","1.5",20,41,3.3,NA,NA,NA,
      "29","112","AS","1.5",19,23,2.5,NA,NA,NA,
      "30","112","AS","1.5",11,13,2.1,NA,NA,NA,
      "31","112","b","b",2,6,2.5,NA,NA,NA,
      "32","112","b","b",15,31,2.8,NA,NA,NA,
      "33","112","b","b",20,36,3,NA,NA,NA,
      "34","112","b","b",18,35,2.6,NA,NA,NA,
      "35","112","b","b",27,16,2.4,NA,NA,NA,
      "36","128","RI","0.5",28,51,4,14,13,-0.3,
      "37","128","RI","0.5",27,38,4.2,12,4,-0.399999999999999,
      "38","128","RI","0.5",33,42,3.4,16,11,-0.2,
      "39","128","RI","0.5",35,50,3.7,23,12,-0.2,
      "40","128","RI","0.5",44,56,3.5,20,15,-0.1,
      "41","128","AS","0.5",45,50,3.2,17,13,-0.2,
      "42","128","AS","0.5",31,42,3,17,21,-1.1,
      "43","128","AS","0.5",34,43,3.5,17,12,-0.2,
      "44","128","AS","0.5",27,35,3.2,13,13,-0.2,
      "45","128","AS","0.5",39,45,2.3,11,7,-0.9,
      "46","128","RI","1",31,48,3.2,6,9,0.1,
      "47","128","RI","1",27,42,3.7,12,9,0.5,
      "48","128","RI","1",NA,NA,NA,NA,NA,NA,
      "49","128","RI","1",35,47,2.4,17,5,-0.9,
      "50","128","RI","1",31,34,3,15,2,0,
      "51","128","AS","1",23,28,2.6,5,5,-0.4,
      "52","128","AS","1",33,52,2.7,8,9,-0.7,
      "53","128","AS","1",26,43,2.2,11,8,-1.1,
      "54","128","AS","1",34,44,2.9,13,14,-0.2,
      "55","128","AS","1",35,42,2.7,12,3,-0.4,
      "56","128","RI","1.5",26,39,3.5,13,9,-0.3,
      "57","128","RI","1.5",15,30,3.2,3,-4,-0.3,
      "58","128","RI","1.5",28,44,4,12,12,-0.2,
      "59","128","RI","1.5",25,49,4.3,13,18,0.5,
      "60","128","RI","1.5",24,43,2.9,5,10,-0.2,
      "61","128","AS","1.5",44,47,3,30,17,-0.2,
      "62","128","AS","1.5",34,34,2.8,15,9,-0.4,
      "63","128","AS","1.5",31,58,2.4,11,17,-0.9,
      "64","128","AS","1.5",36,42,2.3,17,19,-0.2,
      "65","128","AS","1.5",19,20,2.3,8,7,0.2,
      "66","128","b","b",1,8,2.1,-1,2,-0.4,
      "67","128","b","b",36,50,2.7,21,19,-0.0999999999999996,
      "68","128","b","b",30,53,2.6,10,17,-0.4,
      "69","128","b","b",33,52,2.4,15,17,-0.2,
      "70","128","b","b",37,27,2.5,10,11,0.1,
      "71","141","RI","0.5",38,58,4,10,7,0,
      "72","141","RI","0.5",30,60,3.7,3,22,-0.5,
      "73","141","RI","0.5",40,48,3.5,7,6,0.1,
      "74","141","RI","0.5",43,57,3.6,8,7,-0.1,
      "75","141","RI","0.5",49,65,3.7,5,9,0.2,
      "76","141","AS","0.5",56,53,4,11,3,0.8,
      "77","141","AS","0.5",36,48,3.5,5,6,0.5,
      "78","141","AS","0.5",49,53,4.3,15,10,0.8,
      "79","141","AS","0.5",34,44,4,7,9,0.8,
      "80","141","AS","0.5",50,49,3,11,4,0.7,
      "81","141","RI","1",44,64,3.5,13,16,0.3,
      "82","141","RI","1",28,43,3,1,1,-0.7,
      "83","141","RI","1",NA,NA,NA,NA,NA,NA,
      "84","141","RI","1",54,53,3.3,19,6,0.9,
      "85","141","RI","1",39,50,3.4,8,16,0.4,
      "86","141","AS","1",21,30,3.2,-2,2,0.6,
      "87","141","AS","1",42,60,3.5,9,8,0.8,
      "88","141","AS","1",37,59,2.2,11,16,0,
      "89","141","AS","1",48,50,3.4,14,6,0.5,
      "90","141","AS","1",47,49,3.5,12,7,0.8,
      "91","141","RI","1.5",29,50,3.4,3,11,-0.1,
      "92","141","RI","1.5",16,35,3.5,1,5,0.3,
      "93","141","RI","1.5",36,56,4,8,12,0,
      "94","141","RI","1.5",33,66,4,8,17,-0.3,
      "95","141","RI","1.5",48,54,3,24,11,0.1,
      "96","141","AS","1.5",39,70,3.7,-5,23,0.7,
      "97","141","AS","1.5",36,40,3.6,2,6,0.8,
      "98","141","AS","1.5",35,69,3.8,4,11,1.4,
      "99","141","AS","1.5",39,48,3.1,3,6,0.8,
      "100","141","AS","1.5",26,35,3,7,15,0.7,
      "101","141","b","b",NA,NA,NA,NA,NA,NA,
      "102","141","b","b",36,53,3.4,0,3,0.7,
      "103","141","b","b",32,60,3.3,2,7,0.7,
      "104","141","b","b",31,55,3,-2,3,0.6,
      "105","141","b","b",42,37,3.4,5,10,0.9,
      "106","157","RI","0.5",39,64,4,1,6,0,
      "107","157","RI","0.5",37,69,3.7,7,9,0,
      "108","157","RI","0.5",42,50,3.5,2,2,0,
      "109","157","RI","0.5",41,64,3.6,-2,7,0,
      "110","157","RI","0.5",54,73,3.7,5,8,0,
      "111","157","AS","0.5",52,54,4,-4,1,0,
      "112","157","AS","0.5",37,56,4.3,1,8,0.8,
      "113","157","AS","0.5",46,57,3.6,-3,4,-0.7,
      "114","157","AS","0.5",34,48,4.2,0,4,0.2,
      "115","157","AS","0.5",53,55,3.1,3,6,0.1,
      "116","157","RI","1",41,67,3.5,-3,3,0,
      "117","157","RI","1",27,43,3,-1,0,0,
      "118","157","RI","1",NA,NA,NA,NA,NA,NA,
      "119","157","RI","1",55,56,3.2,1,3,-0.0999999999999996,
      "120","157","RI","1",41,55,3.3,2,5,-0.1,
      "121","157","AS","1",20,30,3.2,-1,0,0,
      "122","157","AS","1",42,66,3.6,0,6,0.1,
      "123","157","AS","1",40,65,2.2,3,6,0,
      "124","157","AS","1",51,52,3.4,3,2,0,
      "125","157","AS","1",50,53,3.5,3,4,0,
      "126","157","RI","1.5",31,57,3.5,2,7,0.1,
      "127","157","RI","1.5",16,33,3.5,0,-2,0,
      "128","157","RI","1.5",36,63,4,0,7,0,
      "129","157","RI","1.5",38,78,4,5,12,0,
      "130","157","RI","1.5",52,60,3.1,4,6,0.1,
      "131","157","AS","1.5",42,71,3.8,3,1,0.0999999999999996,
      "132","157","AS","1.5",38,45,3.7,2,5,0.1,
      "133","157","AS","1.5",34,72,3.8,-1,3,0,
      "134","157","AS","1.5",39,50,3.2,0,2,0.1,
      "135","157","AS","1.5",26,40,3.1,0,5,0.1,
      "136","157","b","b",NA,NA,NA,NA,NA,NA,
      "137","157","b","b",38,55,3.1,2,2,-0.3,
      "138","157","b","b",34,60,3.3,2,0,0,
      "139","157","b","b",33,58,3,2,3,0,
      "140","157","b","b",44,41,3.4,2,4,0,
      "141","170","RI","0.5",42,66,4,3,2,0,
      "142","170","RI","0.5",40,77,3.7,3,8,0,
      "143","170","RI","0.5",45,58,3.5,3,8,0,
      "144","170","RI","0.5",43,69,3.6,2,5,0,
      "145","170","RI","0.5",45,78,3.7,-9,5,0,
      "146","170","AS","0.5",56,59,4,4,5,0,
      "147","170","AS","0.5",39,61,4.4,2,5,0.100000000000001,
      "148","170","AS","0.5",52,59,3.6,6,2,0,
      "149","170","AS","0.5",37,53,4.2,3,5,0,
      "150","170","AS","0.5",55,59,3.1,2,4,0,
      "151","170","RI","1",43,78,3.6,2,11,0.1,
      "152","170","RI","1",30,43,3,3,0,0,
      "153","170","RI","1",NA,NA,NA,NA,NA,NA,
      "154","170","RI","1",58,58,3.3,3,2,0.0999999999999996,
      "155","170","RI","1",55,57,3.4,14,2,2.1,
      "156","170","AS","1",24,31,3.2,4,1,0,
      "157","170","AS","1",45,69,3.7,3,3,0.1,
      "158","170","AS","1",44,68,2.2,4,3,0,
      "159","170","AS","1",53,54,3.4,2,2,0,
      "160","170","AS","1",54,56,3.5,4,3,0,
      "161","170","RI","1.5",34,61,3.5,3,4,0,
      "162","170","RI","1.5",16,36,3.5,0,3,0,
      "163","170","RI","1.5",39,38,4,3,-25,0,
      "164","170","RI","1.5",47,136,4,9,58,0,
      "165","170","RI","1.5",54,63,3.1,2,3,0,
      "166","170","AS","1.5",45,74,3.8,3,3,0,
      "167","170","AS","1.5",41,48,3.7,3,3,0,
      "168","170","AS","1.5",37,74,3.8,3,2,0,
      "169","170","AS","1.5",40,51,3.2,1,1,0,
      "170","170","AS","1.5",27,42,3.1,1,2,0,
      "171","170","b","b",NA,NA,NA,NA,NA,NA,
      "172","170","b","b",40,57,3.1,2,2,0,
      "173","170","b","b",34,60,3.3,0,0,0,
      "174","170","b","b",35,59,3,2,1,0,
      "175","170","b","b",45,42,3.4,1,1,0,
              
      
    ), !is.na(hojas))
  
     titulo1 <- switch (input$y,
       "hojas" = "Número de hojas",
       "altura" = "Longitd del brote",
       "circ" = "Circunferencia del brote",
       "cre_h" = "Desarrollo de hojas",
       "cre_a" = "Crecimiento del brote",
       "cre_circ" = "Engrosamiento del brote"
     )
     titulo2 <- switch (input$x,
       "fecha" = "Día juliano",
       "modo_app" = "Modo de aplicación",
       "dosis" = "Dosis en g/L"
     )
     colet <- switch (input$color,
                      "fecha" = "Día juliano",
                      "modo_app" = "Modo de aplicación",
                      "dosis" = "Dosis en g/L"
     )
     ggplot(data = aep2305, aes_string(x = input$x, y = input$y, color = input$color)) +
       geom_boxplot() +
       labs(title = paste(titulo1," vs " , titulo2),
            x = titulo2,
            y = titulo1,
            colour = colet
            )
   })
}

# Run the application 
shinyApp(ui = ui, server = server)

